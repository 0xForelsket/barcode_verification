<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History - Barcode Verification</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}?v=4.0">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <span class="logo">‚¨°</span>
            <span class="title">Job History</span>
        </div>
        <div class="header-right">
            <div class="clock" id="clock">00:00</div>
        </div>
    </header>

    <main class="main-content" style="overflow-y:auto;">
        <div class="page-header">
            <h1>üìú Job History</h1>
            <div class="nav-links">
                <a href="/" class="nav-link">‚Üê Operator</a>
                <a href="/monitor" class="nav-link">Monitor</a>
            </div>
        </div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>Job ID</th>
                    <th>Date/Time</th>
                    <th>Barcode</th>
                    <th>Shippers</th>
                    <th>Pieces</th>
                    <th>Rate</th>
                    <th>Duration</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for job in jobs.items %}
                <tr>
                    <td><strong>{{ job.job_id }}</strong></td>
                    <td>{{ job.start_time.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td class="mono">{{ job.expected_barcode }}</td>
                    <td class="mono">{{ job.total_scans }}</td>
                    <td class="mono">{{ job.total_pieces }}</td>
                    <td style="color:{{ 'var(--success)' if job.pass_rate >= 99 else 'var(--warning)' if job.pass_rate >= 95 else 'var(--danger)' }}">
                        {{ '%.1f' % job.pass_rate }}%
                    </td>
                    <td class="mono">{{ job.elapsed_formatted }}</td>
                    <td>
                        <span class="status-tag {{ 'active' if job.is_active else 'complete' }}">
                            {{ 'Active' if job.is_active else 'Done' }}
                        </span>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align:center;color:var(--text-muted);padding:40px;">
                        No jobs found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if jobs.pages > 1 %}
        <div class="pagination">
            <a href="{{ url_for('history', page=jobs.prev_num) }}" class="{{ 'disabled' if not jobs.has_prev else '' }}">
                ‚Üê Prev
            </a>
            <span class="page-info">Page {{ jobs.page }} of {{ jobs.pages }}</span>
            <a href="{{ url_for('history', page=jobs.next_num) }}" class="{{ 'disabled' if not jobs.has_next else '' }}">
                Next ‚Üí
            </a>
        </div>
        {% endif %}
    </main>

    <script>
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', { 
                hour12: false, hour: '2-digit', minute: '2-digit' 
            });
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
